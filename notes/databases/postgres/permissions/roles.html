<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <style rel="stylesheet">
    body{
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin:40px auto;
      max-width:750px;
      font-size:18px;
      padding:0 10px;
      color: #333;
    }
    pre {
      background: #f4f4f4;
      border: 1px solid #ddd;
      border-left: 3px solid #000;
      color: #777;
      page-break-inside: avoid;
      font-family: monospace;
      font-size: 15px;
      max-width: 100%;
      overflow: auto;
      padding: 1em 1.5em;
      display: block;
      word-wrap: break-word;
    }
    a {
      color: #1976d2;
      text-decoration: none;
      border-bottom: 1px solid;
    }
    img {
      max-width: 100%;
    }
    h1 {
      text-align: left;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    li {
      margin-bottom: 10px;
    }
    :not(pre) > code {
      background-color: #f4f4f4;
      padding-right: 0.2em;
      padding-left: 0.2em;
      border-radius: 3px;
    }
  </style>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1>Roles</h1>
<pre><code>Created at: 2025-07-01
</code></pre>
<p>CREATE USER and CREATE GROUP which are both aliases for CREATE ROLE.
In postgres, roles, groups, and users have all been merged to the same concept.</p>
<p>In practice nothing changes. Roles can inherit from other roles, be used to
create tables, to login, etc.</p>
<pre><code class="language-sql">-- Roles and users are effectively the same thing in modern Postgres versions.
-- Roles can log in, inherit other roles, access db objects, etc.
CREATE ROLE sweet_role;
CREATE USER sweet_user;
GRANT sweet_role TO sweet_user;
SELECT
  rolname,
  rolinherit
FROM
  pg_roles
WHERE
  rolname = 'sweet_role';
--   rolname   | rolinherit
-- ------------+------------
--  sweet_role | t


-- The default is to have INHERIT, but we add it for clarification.
CREATE ROLE inherited_sweet_role WITH INHERIT;
GRANT sweet_role TO inherited_sweet_role;
SELECT
  rolname,
  rolinherit
FROM
  pg_roles
WHERE
  rolname = 'inherited_sweet_role';
--   rolname   | rolinherit
-- ------------+------------
--  inherited_sweet_role | t

-- Create a table and grant ownership to sweet_role.
DROP TABLE IF EXISTS public.foo;
CREATE TABLE public.foo (id SERIAL PRIMARY KEY);
ALTER TABLE public.foo OWNER TO &quot;sweet_role&quot;;

-- The inherited role does not show up on this query.
SELECT
  grantee,
  table_schema AS schema,
  table_name,
  privilege_type AS privilege,
  grantor
FROM
  information_schema.table_privileges
WHERE
  table_name = 'foo'
  AND table_schema = 'public';
--   grantee   | schema | table_name | privilege  |  grantor
-- ------------+--------+------------+------------+------------
--  sweet_role | public | foo        | INSERT     | sweet_role
--  sweet_role | public | foo        | SELECT     | sweet_role
--  sweet_role | public | foo        | UPDATE     | sweet_role
--  sweet_role | public | foo        | DELETE     | sweet_role
--  sweet_role | public | foo        | TRUNCATE   | sweet_role
--  sweet_role | public | foo        | REFERENCES | sweet_role
--  sweet_role | public | foo        | TRIGGER    | sweet_role

-- But you can check membership as such:
-- pg_has_role ( [ user name or oid, ] role text or oid, privilege text )
--
-- Allowable privilege types are MEMBER, USAGE, and SET. MEMBER denotes direct
-- or indirect membership in the role without regard to what specific privileges
-- may be conferred. USAGE denotes whether the privileges of the role are
-- immediately available without doing SET ROLE, while SET denotes whether it is
-- possible to change to the role using the SET ROLE command. SELECT
SELECT pg_has_role('inherited_sweet_role', 'sweet_role', 'MEMBER');
-- pg_has_role
-------------
-- t

-- The ultimate proof:
SET ROLE TO 'inherited_sweet_role';
SELECT * FROM public.foo;
INSERT INTO foo (id) VALUES (1);

SET ROLE TO 'marcelo.fernandes'; -- admin user
CREATE ROLE role_without_ownership;
SET ROLE TO role_without_ownership;

SELECT * FROM public.foo;
-- ERROR:  permission denied for table foo
</code></pre>
<script async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>
</body>
</html>
